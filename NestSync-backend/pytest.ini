[tool:pytest]
# Pytest configuration for NestSync Backend
# PIPEDA-compliant Canadian diaper planning application

# Test discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Minimum version
minversion = 7.4

# Add options
addopts =
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=app
    --cov-report=html:coverage_html
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=80
    --disable-warnings

# Markers for test categorization
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, requires database)
    graphql: GraphQL resolver tests
    api: REST API endpoint tests
    auth: Authentication and authorization tests
    payments: Stripe payment integration tests
    ml: Machine learning prediction tests
    retailer: Retailer API integration tests
    websocket: WebSocket real-time functionality tests
    slow: Slow tests that take more than 10 seconds
    canadian: Canadian compliance and PIPEDA tests
    subscription: Subscription management tests
    reorder: Automated reorder system tests
    emergency: Emergency access system tests

# Test environment
env =
    ENVIRONMENT = testing
    DATABASE_URL = postgresql+asyncpg://postgres:test@localhost:5432/nestsync_test
    SECRET_KEY = test-secret-key-for-testing-only
    SUPABASE_URL = https://test.supabase.co
    SUPABASE_KEY = test-key
    SUPABASE_SERVICE_KEY = test-service-key
    SUPABASE_JWT_SECRET = test-jwt-secret
    STRIPE_SECRET_KEY = sk_test_test_key
    STRIPE_PUBLISHABLE_KEY = pk_test_test_key
    STRIPE_WEBHOOK_SECRET = whsec_test_secret
    REDIS_URL = redis://localhost:6379/1
    LOG_LEVEL = WARNING

# Asyncio configuration
asyncio_mode = auto

# Coverage configuration
coverage_omit =
    */tests/*
    */venv/*
    */migrations/*
    */__pycache__/*
    */site-packages/*